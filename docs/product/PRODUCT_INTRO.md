# OpenRefine 产品手册

## 一、产品概述

### 1.1 产品介绍

OpenRefine 是一款功能强大的开源数据处理工具，由 Java 语言开发，采用 Web 浏览器作为用户界面。它能够帮助用户加载、清洗、匹配和增强来自各种来源的数据，所有操作均在用户本地计算机上完成，确保数据的私密性和安全性。OpenRefine 最初由 Metaweb Technologies 公司开发，后被 Google 收购并更名为 Google Refine，2012 年更名为 OpenRefine 并成为社区驱动的开源项目，目前由 Code for Science and Society 机构赞助维护。

OpenRefine 的设计理念是为数据分析师、研究人员和档案工作者提供一个灵活、强大的数据处理环境。与传统电子表格软件不同，OpenRefine 专注于处理中等规模的数据集（从几千行到几十万行），提供了丰富的可视化操作和强大的表达式语言，让用户能够以非线性的方式探索和操作数据。它支持无限次的撤销和重做操作，每一步操作都被记录在历史中，用户可以随时回溯到之前的任何状态。这种设计使得数据处理过程更加安全和可控，即使出现操作失误也能轻松恢复。

作为一款开源软件，OpenRefine 拥有活跃的社区支持和完善的扩展机制。用户不仅可以免费使用软件本身，还可以根据需求开发自定义扩展。软件支持超过 40 种语言界面，包括中文、英文、日文、法文、德文等主要语言，这使得全球用户都能无障碍地使用这款工具。OpenRefine 采用 BSD 开源许可证，允许用户自由使用、修改和分发软件代码。

### 1.2 产品定位

OpenRefine 定位为专业数据处理工具，主要面向以下用户群体：数据分析师可以利用它进行数据清洗、格式转换和初步探索；研究人员可以借助它处理实验数据、整理调研结果；档案工作者可以使用它管理数字化档案资源、建立元数据目录；记者和调查人员可以利用它分析公开数据、发现数据关联。此外，对于需要处理大量结构化数据但又不需要复杂数据库系统的场景，OpenRefine 是一个理想的选择。

OpenRefine 不是一款 BI（商业智能）工具，也不是数据库管理系统。它更像是一个数据工作台，介于电子表格和数据库之间填补了一个重要的空白。当数据量超过 Excel 的处理能力，但又不值得为简单任务启动一个完整的数据库系统时，OpenRefine 就是最佳选择。它能够在单机上高效处理数十万行数据，同时提供比 Excel 更强大的数据操作能力和更友好的用户体验。

### 1.3 核心价值

OpenRefine 的核心价值体现在以下几个方面：首先是数据隐私保护，所有数据处理都在本地完成，不需要将敏感数据上传到云端，这对于处理个人隐私数据、商业机密数据或涉密档案数据尤为重要；其次是操作可追溯性，每一次数据变更都被记录在历史中，支持任意回溯，确保数据处理的规范性和可审计性；第三是高度可扩展性，模块化的架构设计使得用户可以根据需要启用或禁用功能扩展，社区也贡献了多个有用的扩展插件；第四是强大的数据处理能力，专业的表达式语言和丰富的内置函数能够应对各种复杂的数据处理需求。

## 二、功能特性

### 2.1 数据导入与导出

OpenRefine 提供了全面的数据导入功能，支持从多种来源将数据加载到工作区。在文件格式方面，软件原生支持 CSV（逗号分隔值）、TSV（制表符分隔值）、Excel（包含 .xls 和 .xlsx 两种格式）、JSON、XML、HTML 等常见的结构化和半结构化数据格式。对于每种格式，软件都会自动识别数据结构并提供预览功能，用户可以在正式导入前检查数据是否正确解析。此外，软件还支持从剪贴板直接粘贴数据，以及通过 URL 从网络获取数据文件。

在数据库集成方面，OpenRefine 提供了强大的数据库扩展模块。通过 JDBC 标准接口，软件能够连接 MySQL、PostgreSQL、MariaDB、SQLite 等主流关系型数据库。用户可以选择导入整个表的数据，也可以编写自定义 SQL 查询来精确控制导入的数据范围。专门针对档案数据库场景，OpenRefine 还开发了 Records-DB 扩展，支持 Schema Profile 配置和预置模板，能够更好地适应档案数据的特点，实现灵活的数据导入。

数据导出功能同样完善。用户可以将处理后的数据导出为各种常用格式，包括 CSV、TSV、Excel、HTML、JSON、XML 等。对于需要进一步在数据库中处理的数据，OpenRefine 可以直接导出为 SQL INSERT 语句格式。软件还支持自定义导出模板，用户可以定义输出格式以满足特定需求。针对档案业务场景，Records-Assets 扩展还支持将数据绑定的资源文件批量导出，方便档案的整理和移交工作。

### 2.2 数据清洗与转换

数据清洗是 OpenRefine 的核心功能之一。软件提供了丰富的列操作功能，包括添加新列、删除不需要的列、重命名列名、调整列顺序、拆分列（按分隔符或固定宽度）、合并多列内容等。对于单元格级别的编辑，用户可以单个修改也可以批量替换，支持普通字符串替换和高级的正则表达式替换。所有编辑操作都可以基于条件执行，只对满足特定条件的行或单元格生效。

数据转换功能依赖于 OpenRefine 独特的表达式语言（GREL）。这种类 JavaScript 的表达式语言功能强大且易于学习，用户可以通过简单的函数调用完成复杂的数据处理任务。GREL 支持数学运算（加减乘除、幂运算、四舍五入等）、字符串操作（截取、查找、替换、大小写转换等）、数组操作（排序、去重、合并等）、日期处理（日期解析、格式化、计算日期差等）。更重要的是，GREL 支持链式调用，用户可以将多个函数串联起来，对数据依次应用多步转换。

OpenRefine 还提供了便捷的批量操作功能。"填充"功能可以向下或向上填充空白单元格，将上一个非空值复制到后续的空单元格中。"去重"功能能够基于一列或多列的值识别并删除重复的行。"排序"功能支持按文本、数值、日期等多种类型进行升序或降序排列，同时保持行的完整性。这些批处理操作极大地提高了数据清洗的效率，让用户能够快速将混乱的数据整理成结构化的形式。

### 2.3 分面与过滤

分面（Facet）是 OpenRefine 中最强大的数据探索工具之一。通过分面，用户可以从不同角度快速了解数据的分布情况，并方便地筛选出需要关注的数据子集。文本分面会统计某一列中每个唯一值出现的次数，以列表形式展示，用户可以点击选择查看特定值的行。数值分面会将数值划分成范围区间，以直方图形式展示数据的分布趋势，用户可以拖动滑块选择感兴趣的数值范围。

过滤功能与分面相辅相成。用户可以通过多种方式设置过滤条件：基于文本搜索的快速过滤可以在所有列中搜索包含特定文本的行；基于正则表达式的过滤支持更复杂的匹配模式；自定义过滤允许用户编写表达式来定义筛选逻辑。OpenRefine 还支持组合多个过滤条件，各条件之间可以是"且"（AND）或"或"（OR）的关系。过滤条件可以保存为预设，方便在需要时快速应用相同的筛选。

分面和过滤功能的一个重要应用场景是数据质量检查。通过观察分面中各值的分布，用户可以快速发现异常值或异常数据模式。例如，如果某一列的日期格式不一致，切换到该列的分面视图后就会清楚地看到各种不同的日期写法。用户可以逐一选择正确的值，将错误的数据筛选出来进行批量修复。这种可视化的数据质量控制方式比传统的逐行检查高效得多。

### 2.4 数据匹配与链接

数据匹配（Reconciliation）是 OpenRefine 的特色功能之一，它能够将本地数据与外部知识库进行匹配，从而获取更丰富的信息。匹配服务通常由外部数据提供商提供，OpenRefine 通过标准化的接口与其通信。目前最常用的匹配数据源是 Wikidata，它是一个免费开放的知识库，包含数百万个实体（人物、地点、组织、概念等）的结构化信息。通过 Wikibase 扩展，用户可以将自己的数据与 Wikidata 进行匹配。

匹配过程通常是半自动化的。OpenRefine 会根据用户选择的列，将每个单元格的值发送给匹配服务，匹配服务返回可能的候选实体列表以及每个候选实体的置信度分数。用户可以批量接受高置信度的匹配结果，对于低置信度的结果可以手动选择正确的候选或跳过匹配。已匹配的数据可以通过额外的数据增强步骤，从匹配到的实体中获取更多属性信息，添加到本地数据中。

Wikibase 扩展不仅支持从 Wikidata 获取数据，还支持向 Wikibase 写入数据。用户可以定义自己的模式（Schema），将本地数据的列映射到目标 Wikibase 的属性，然后批量创建或更新 Wikibase 中的实体。这对于需要将整理好的数据发布到Wikibase 项目（如 Wikidata、OpenStreetMap Wiki 等）的用户来说非常有用。软件提供了模式对齐界面和预览功能，帮助用户验证映射是否正确。

### 2.5 数据质量检查

数据质量检查是面向档案业务场景的重要扩展功能。该功能通过图形化的界面帮助用户验证数据的格式正确性、内容准确性和资源关联性。质量规则分为三种类型：格式检查规则用于验证数据的格式是否符合预期，包括唯一性检查（非空字段是否有重复值）、非空检查（必填字段是否为空）、值域检查（值是否在允许的范围内）、日期格式检查（日期是否符合指定格式）、正则表达式检查（值是否匹配指定的正则模式）。

内容正确性检查是数据质量功能的高级特性。它通过集成 OCR 信息抽取服务，从档案资源文件中提取关键信息，然后将抽取结果与数据库中的元数据进行比对。这种检查方式能够发现元数据著录与原始文件内容之间的不一致，帮助用户发现潜在的著录错误。系统支持自定义相似度阈值，当抽取结果与元数据的相似度低于阈值时会产生警告，用户可以人工复核确认。

资源关联性检查用于验证档案数据与其对应的电子资源文件之间的一致性。检查项目包括：文件是否存在（指定的资源路径下是否有对应的文件）、文件数量是否一致（数据中记录的页数与实际文件数量是否匹配）、文件夹命名是否符合规范、文件命名是否符合规范、文件夹序号是否连续、文件序号是否连续等。这些检查对于确保数字化档案的完整性和可追溯性非常重要。

### 2.6 资源文件管理

Records-Assets 扩展专门用于管理档案数据绑定的电子资源文件。该扩展提供了目录浏览功能，用户可以以树形结构查看资源目录，快速定位到需要的文件夹。扩展支持分页显示，对于包含大量文件的目录也能流畅展示。目录列表会显示每个文件和文件夹的名称、大小、修改时间等基本信息，帮助用户了解资源的情况。

文件预览功能是该扩展的核心特性之一。用户可以直接在 OpenRefine 界面中预览多种类型的资源文件，包括图片（支持常见图片格式）、PDF 文档（使用 pdf.js 嵌入显示）、Word 文档（提供下载链接）等。文本类型的文件可以直接在浏览器中显示内容。预览功能采用按需加载机制，只在用户点击预览时才加载文件内容，避免了不必要的网络开销。

资源文件导出功能允许用户将数据绑定的文件批量导出。用户可以配置导出的目标路径和命名规则，支持将多个字段的值拼接成文件路径。导出过程会显示进度和统计信息，包括成功导出的文件数、失败的次数和原因。用户可以选择复制或移动文件操作，复制模式保留原始文件，移动模式则将文件转移到目标位置后删除原文件。导出功能与数据质量检查功能配合使用，可以方便地整理和移交档案数据。

## 三、使用场景

### 3.1 档案数字化整理

在档案数字化工作中，OpenRefine 是一个非常实用的辅助工具。档案馆在完成数字化扫描后，通常会导出元数据到 Excel 或 CSV 文件中。但导出的元数据往往存在格式不统一、字段缺失、错别字等问题，需要进行清洗和整理。OpenRefine 的分面功能可以快速发现数据中的异常值，去重功能可以识别重复的条目，表达式语言可以批量修正格式错误。

对于从不同系统导出的档案数据，OpenRefine 还可以进行数据整合和标准化。假设一个档案馆从多个旧系统导出了元数据，每个系统的字段定义和编码规则都不相同。通过 OpenRefine，用户可以创建一个统一的数据模型，将各系统的数据映射到标准字段，同时转换编码格式使之一致。这个过程可以记录为操作历史，方便日后追溯数据处理的每一步。

档案数据与电子资源文件的关联是数字化整理的重要内容。OpenRefine 的 Records-DB 扩展和 Records-Assets 扩展专门为此场景设计。用户可以定义数据列到文件路径的映射关系，实现元数据与资源文件的关联。质量检查功能可以自动验证关联是否正确，发现缺失的文件或不对应的记录。这大大减轻了档案工作人员的核对工作量，也提高了数据的准确性。

### 3.2 数据分析与清洗

数据分析师在进行分析工作之前，通常需要花费大量时间进行数据清洗和预处理。OpenRefine 为这个过程提供了高效的解决方案。与在 Excel 中逐个单元格修改不同，OpenRefine 的批量编辑和表达式功能可以一次性处理成千上万的数据行。例如，将所有日期统一转换为标准格式，将字符串中的多余空格删除，拆分复合字段等操作都可以轻松完成。

在探索性数据分析阶段，OpenRefine 的分面功能可以帮助分析师快速了解数据的分布情况。通过观察各列的唯一值和出现频率，分析师可以初步判断数据的质量、识别潜在的问题模式。数值分面的直方图可以直观展示数据的分布范围和异常值。分析师还可以使用表达式语言创建计算列，进行初步的统计计算。

数据匹配功能使得分析师能够将本地数据与外部知识库进行关联。例如，在分析企业数据时，可以将企业名称与工商注册信息库匹配，获取统一社会信用代码、注册地址、经营范围等补充信息。在分析地理位置数据时，可以将地名与地理知识库匹配，获取经纬度、行政区划代码等坐标信息。这些关联增强了数据的分析价值。

### 3.3 研究数据管理

研究人员在使用定量研究方法时，往往需要处理来自问卷调查、实验测量、文献检索等多种渠道的数据。这些数据的格式和编码往往不一致，需要进行整合和标准化。OpenRefine 可以帮助研究人员快速完成这些数据准备工作，将更多时间投入到实际的分析工作中。

在文献计量学研究中，研究人员经常需要处理从各大学术数据库导出的文献数据。不同数据库的导出格式和字段定义各不相同，需要统一转换。OpenRefine 可以批量处理这些数据：统一作者姓名的格式（如将"张, 三"转换为"张三"），统一期刊名称的写法，统一出版年的格式，提取作者单位信息等。这些处理为后续的共现分析、引用网络分析等做好准备。

对于涉及个人信息的研究数据，OpenRefine 的本地运行特性非常重要。研究数据往往包含敏感的个人信息，研究人员不希望将这些数据上传到云端处理。OpenRefine 完全在本地运行，所有数据都保存在用户的计算机上，确保了数据的安全性。同时，操作历史记录功能也方便研究人员日后追溯数据处理的每个步骤，满足科研数据管理的规范要求。

### 3.4 知识库建设与维护

Wikidata 是一个由志愿者编辑维护的大型知识库，包含了大量结构化的实体信息。OpenRefine 的 Wikibase 扩展为 Wikidata 的批量编辑提供了便利的工具。志愿者可以使用 OpenRefine 准备要添加或修改的数据，定义数据到属性的映射关系，然后在预览确认后批量上传到 Wikidata。这种方式比直接在 Wikidata 网页上逐条编辑高效得多，特别适合处理大量数据条目。

除了 Wikidata，Wikibase 扩展还支持连接到私有 Wikibase 实例。一些组织会部署自己的 Wikibase 系统来构建内部知识库。OpenRefine 的 Wikibase 扩展同样可以用于这些私有实例，帮助组织批量导入和更新知识库内容。这对于企业知识管理、政府文档管理、博物馆藏品数据库等应用场景都非常有用。

数据质量的维护是知识库建设的长期任务。随着时间推移，知识库中可能出现过时信息、错误数据或格式不一致的条目。OpenRefine 可以定期从原始数据源提取更新，与知识库中的现有数据进行比对，发现需要更新的条目。通过批量编辑功能，可以高效地完成数据更新工作。数据验证功能还可以帮助管理员检查知识库中数据的一致性，发现和修复潜在的问题。

## 四、技术架构

### 4.1 系统架构

OpenRefine 采用经典的前后端分离架构。后端基于 Java 语言开发，使用 Jetty 作为 Web 服务器，提供 RESTful API 接口处理业务逻辑。前端使用 JavaScript 开发单页应用，通过 AJAX 技术与后端 API 通信。这种架构使得系统具有良好的扩展性和可维护性，同时也方便与其他系统进行集成。

后端核心模块包括项目管理系统、数据处理引擎、表达式解析器、导入导出模块等。项目管理负责项目的创建、存储、加载和删除，每个项目的数据和元数据以压缩格式存储在工作目录中。数据处理引擎实现了各种数据操作功能，包括列操作、行操作、单元格编辑等。表达式解析器负责解析和执行用户编写的 GREL 表达式。导入导出模块处理各种格式的数据读写。

前端界面基于 jQuery 框架构建，使用自定义的 UI 组件。界面采用多面板布局，包括数据视图面板、分面过滤面板、历史记录面板等。所有的数据操作都通过 AJAX 调用后端 API 完成，前端负责界面的渲染和用户交互的响应。前端代码模块化组织，核心功能与扩展功能分离，便于维护和扩展。

### 4.2 扩展机制

OpenRefine 提供了完善的扩展机制，允许第三方开发者为系统添加新功能。扩展可以注册新的导入器以支持新的数据格式，添加新的导出器以输出到新的目标，扩展菜单系统添加新的功能入口，创建新的界面组件，或添加新的后端 API 端点。这种模块化的设计使得 OpenRefine 能够适应各种不同的使用场景。

扩展的开发遵循标准化的流程。每个扩展都是一个独立的 Maven 项目，包含自己的源代码、配置文件和资源文件。扩展需要提供 module.properties 文件来声明模块信息和依赖关系，通过 controller.js 文件注册扩展的各个组件。后端 Java 代码需要实现相应的接口或继承指定的类，前端 JavaScript 代码需要遵循模块化规范编写。扩展开发文档详细说明了各种扩展点的接口规范。

目前 OpenRefine 社区已经开发了多个有用的扩展。数据库扩展支持从各种关系型数据库导入数据；Wikibase 扩展支持与 Wikidata/Wikibase 交互；Jython 扩展支持使用 Python 脚本进行高级数据处理；PC-Axis 扩展支持导入统计数据格式。针对档案业务需求，还开发了 Records-DB、Records-Assets、Data-Quality 等专用扩展，显著增强了系统对档案工作场景的支持能力。

### 4.3 数据存储

OpenRefine 项目的本地存储采用专有的压缩格式。每个项目对应工作目录下的一个文件夹，包含 data.zip 文件（存储项目数据）和 metadata.json 文件（存储项目元数据）。data.zip 内部采用自定义的列式存储格式，支持高效的数据访问和操作。metadata.json 记录了项目的配置信息，如列定义、历史记录、拼图配置等。

历史记录是 OpenRefine 的重要特性。每个操作都会生成一个历史条目，记录操作的类型、参数和影响范围。用户可以随时查看历史记录，选择撤销任意数量的操作。历史记录与项目数据分开存储，确保历史记录的加载不会影响正常的项目操作。大量历史操作可能会占用较多存储空间，用户可以选择压缩历史来节省空间。

扩展模块可以声明自己的 overlay model 来存储额外的数据。overlay model 与主项目数据分离，但会随项目一起保存和加载。例如，Records-DB 扩展使用 overlay model 存储数据源配置、Schema Profile 设置等信息，使得这些配置能够永久保存到项目中，下次打开项目时自动恢复。这种机制使得扩展能够无缝集成到 OpenRefine 的项目管理体系中。

## 五、运行环境

### 5.1 系统要求

OpenRefine 对运行环境有一定的要求。在操作系统方面，软件支持 Windows、macOS 和 Linux 三大主流桌面操作系统。Windows 版本支持 Windows 10 及以上版本；macOS 版本需要 macOS 10.15 (Catalina) 及以上版本；Linux 版本在大多数主流发行版上都能正常运行。

在 Java 运行环境方面，OpenRefine 需要 JDK 11 或更高版本。建议使用 Eclipse Temurin (原 AdoptOpenJDK) 或其他 OpenJDK 发行版。软件不依赖特定的商业 JDK，开源的 OpenJDK 完全能够满足需求。运行前需要确保 JAVA_HOME 环境变量正确配置为 JDK 的安装路径。

内存需求取决于处理的数据量。对于几千行到几万行的中等规模数据，2GB 内存通常足够。处理几十万行的大数据集时，建议分配 4GB 或更多内存。OpenRefine 可以在启动参数中配置 JVM 堆内存大小，通过 -m 参数指定最大内存。在处理大型项目时，充足的内存是保证流畅操作体验的关键。

### 5.2 依赖组件

OpenRefine 的运行需要几个关键的依赖组件。Apache Maven 用于管理 Java 项目的构建和依赖，在开发环境需要安装，运行时不需要。Node.js 用于前端资源的打包和测试，在开发环境需要安装 18 或更高版本，运行时不需要。某些扩展可能需要额外的系统库，如数据库扩展需要相应的 JDBC 驱动。

外部服务集成方面，Records-Assets 扩展的文件预览功能可能需要安装额外的软件来支持某些文件类型（如 LibreOffice 用于 Word 文档转换）。Data-Quality 扩展的内容比对功能需要连接 Jinshu-aimp 信息抽取服务。这些外部依赖都是可选的，禁用相应功能后可以不安装。

网络连接主要用于两个方面：一是访问外部数据源（如数据库、Wikidata），二是检查软件更新。OpenRefine 支持配置代理服务器来访问网络资源。在完全隔离的环境中运行，软件的基本功能仍然可用，只是无法访问需要网络的功能。

## 六、快速入门

### 6.1 安装与启动

获取 OpenRefine 的最简单方式是从官方网站下载预编译的发行版。访问 https://openrefine.org/download.html 可以找到各个操作系统的安装包。Windows 用户下载 .exe 安装程序或 .zip 压缩包；macOS 用户下载 .dmg 镜像或 .zip 压缩包；Linux 用户下载 .tar.gz 压缩包。下载完成后，按照对应系统的说明进行安装。

对于开发者或需要最新功能的用户，也可以从源码编译 OpenRefine。克隆 GitHub 仓库后，确保安装了 JDK 11+、Maven 和 Node.js，然后在项目根目录执行 ./refine (Linux/macOS) 或 refine.bat (Windows) 命令即可启动。首次编译会自动下载所有依赖，可能需要一些时间。

启动后，OpenRefine 会在默认浏览器中打开一个新标签页，地址为 http://127.0.0.1:33333。这个地址是本地访问地址，数据不会发送到互联网。如果浏览器没有自动打开，也可以手动输入这个地址访问 OpenRefine 界面。关闭 OpenRefine 时，需要在界面上点击关闭按钮或按 Ctrl+C (Windows/Linux) 或 Cmd+C (macOS) 停止服务器。

### 6.2 创建项目

创建项目是使用 OpenRefine 的第一步。首次打开 OpenRefine 时，会显示"创建项目"页面，提供多种数据来源选择。最常用的是"从本机选择文件"，点击后可以选择要导入的数据文件。选择文件后，OpenRefine 会解析文件内容并显示预览。如果文件包含多张工作表或多个记录类型，可以选择要导入的部分。

导入设置页面允许用户配置导入的细节。对于 CSV/TSV 文件，可以指定分隔符、编码格式等参数。对于 Excel 文件，可以选择工作表。对于包含标题行的文件，指定标题行后 OpenRefine 会自动将第一行作为列名。用户还可以在这里选择要导入的列，排除不需要的列。

配置完成后，点击"创建项目"按钮，OpenRefine 会导入数据并创建项目。项目创建完成后会显示主界面，左侧是分面和过滤面板，右侧是数据视图。用户可以在数据视图中浏览和编辑数据，在左侧面板中使用分面和过滤功能。首次创建项目时，系统会提示用户指定工作目录，项目文件将保存在该目录下。

### 6.3 基础操作

学会基础操作后，用户就可以开始处理数据了。单元格编辑是最简单的操作：双击一个单元格即可进入编辑状态，修改后按 Enter 确认。对于批量编辑，可以选中多个单元格（使用 Ctrl/Cmd 点击选择不连续的单元格，或使用全选框选择所有单元格），然后在"编辑"菜单中选择"编辑单元格"，设置替换内容和选项。编辑菜单还提供了基于表达式的编辑功能，可以根据计算结果修改单元格值。

列操作通过列菜单完成。将鼠标移到列标题上，会显示一个下拉箭头，点击后打开列菜单。常用操作包括：重命名列、删除列、移动列（左右）、拆分列（按分隔符或固定宽度）、移除非重复值、基于列添加新列等。"基于列添加列"功能特别有用，可以用表达式从现有列计算出新的列值。

历史记录功能是 OpenRefine 的特色。左侧面板有"历史"标签，点击后显示操作历史列表。每个历史条目显示了操作类型和简要信息，点击可以展开查看详细信息。选中一个历史条目后，点击"撤销"按钮可以回退到该操作之前的状态。撤销后如果改变主意，可以点击"重做"恢复。这个功能让用户可以放心地尝试各种操作，不必担心出错后无法挽回。

### 6.4 进阶技巧

掌握基础操作后，用户可以学习一些进阶技巧来提高效率。分面组合使用可以快速定位特定类型的数据。例如，先用文本分面筛选出"产品"类别，再用数值分面筛选出价格在 100-200 元范围的记录，这种组合过滤可以快速缩小数据范围。

表达式语言是处理复杂数据的有力工具。点击"表达式"链接（通常在列菜单中或编辑菜单中）可以打开表达式编辑器。表达式支持多种函数，可以进行数学计算、字符串操作、日期处理等。例如，toDate(cells["日期"].value).format("yyyy-MM-dd") 可以将各种格式的日期统一转换为标准格式。表达式支持链式调用，如 trim(toLowercase(value)) 可以先转小写再去除首尾空格。

批量处理大量相似数据时，可以使用"变换"功能。在列菜单中选择"变换"，编写一个表达式，OpenRefine 会将该表达式应用到该列的所有单元格上。这比逐个修改高效得多，特别是对于需要统一格式或修正错误值的情况。变换功能也支持基于条件的执行，只修改满足特定条件的单元格。

## 七、扩展指南

### 7.1 Records-DB 扩展

Records-DB 扩展为 OpenRefine 增加了从档案数据库导入数据的能力。使用该扩展前，需要确保已启用扩展模块（在 OpenRefine 的启动参数中指定或通过配置文件启用）。启用后，在创建项目页面会新增"从档案数据库导入"选项。

使用 Records-DB 导入数据需要经过几个步骤。首先是选择连接配置，用户需要指定数据库类型（MySQL、PostgreSQL 等）、连接主机、端口、数据库名、用户名和密码。扩展支持保存连接配置以便重复使用。然后是选择 Schema Profile，Profile 定义了数据的结构，包含要导入的表、字段和字段类型。扩展提供了几个预置模板（库宝、平表、通用 JSON），用户也可以根据数据库结构创建自定义 Profile。

配置完成后，扩展会返回数据预览，用户可以查看要导入的数据样例。如果需要，可以配置过滤器来只导入满足特定条件的记录。过滤器支持多条件组合，每个条件可以指定字段、操作符和值。预览满意后，点击"创建项目"按钮，扩展会将选定的数据导入到 OpenRefine 项目中。导入的大型数据集性能经过优化，导入 1000 行数据仅需约 45 毫秒。

### 7.2 Records-Assets 扩展

Records-Assets 扩展用于管理与项目关联的电子资源文件。该扩展需要在 Records-DB 导入的项目中配置后才能使用。配置包括指定资源文件的基础路径和文件映射关系。文件映射定义了如何从项目数据生成资源文件的完整路径，支持多字段拼接。

配置完成后，可以通过"导出"菜单中的"导出数据绑定资源"功能访问资源管理功能。该功能提供一个对话框，用户可以查看资源目录结构、预览文件内容、执行批量导出操作。目录树支持分页显示，对于包含大量文件夹的目录也能流畅浏览。文件预览支持多种格式：图片直接在浏览器中显示，PDF 使用嵌入阅读器显示，Word 提供下载链接。

导出功能支持灵活的目标路径配置。用户可以指定导出目标基础路径，以及如何从项目数据构建路径。表达式语法支持字段拼接，如 "${基础路径}/${档号}"。用户可以选择复制或移动操作，复制保留原始文件，移动会删除原文件。导出过程会显示进度条和统计信息，包括成功、失败、跳过的文件数量。失败时会显示具体的错误原因，方便用户排查问题。

### 7.3 Data-Quality 扩展

Data-Quality 扩展为 OpenRefine 增加了数据质量检查功能。该功能集成在项目界面中，通过"数据质量"菜单访问。菜单提供三个选项：编辑质量规则、管理质量规则、立即检查。首次使用需要先编辑质量规则，定义要检查的项目和检查方式。

质量规则的编辑界面分为三个子标签页：数据格式检查、文件资源关联检查、内容比对检查。数据格式检查用于定义列级别的检查规则，如某列是否非空、是否唯一、值是否匹配正则表达式、日期格式是否正确等。系统预置了档案著录规则模板，用户可以选择应用模板，然后根据实际情况调整。文件资源关联检查用于验证项目数据与资源文件的对应关系。内容比对检查需要连接外部 OCR 服务，能够从资源文件中抽取信息并与元数据比对。

定义好规则后，可以保存规则供以后复用。规则可以设为共享规则，保存为全局配置，在多个项目中共享使用。执行检查后，系统会显示检查结果。结果页面分为摘要和详情两部分。摘要显示总行数、通过行数、错误数、警告数，以及各类错误的分布统计。详情列表显示每一条发现的问题，包括行号、列名、问题类型、严重程度和详细描述。用户可以根据问题类型或严重程度筛选结果，快速定位需要处理的数据。

## 八、常见问题

### 8.1 安装与运行问题

问：OpenRefine 启动后浏览器打不开怎么办？答：首先确认 OpenRefine 确实已经启动（查看命令行输出是否有错误信息），然后手动在浏览器地址栏输入 http://127.0.0.1:33333 访问。如果还是打不开，可能是防火墙阻止了连接，可以检查防火墙设置允许 OpenRefine 的端口访问。

问：提示 Java 版本不兼容怎么办？答：OpenRefine 需要 JDK 11 或更高版本。运行 java -version 检查当前 Java 版本。如果版本过低，需要安装新版本的 JDK。如果系统中安装了多个 Java 版本，可以通过 JAVA_HOME 环境变量指定要使用的版本，或在 OpenRefine 启动脚本中直接指定 Java 可执行文件的路径。

问：处理大文件时内存不足怎么办？答：可以通过启动参数增加 OpenRefine 的内存限制。在 refine.bat (Windows) 或 ./refine (Linux/macOS) 启动脚本中，修改 -m 参数的值，如 -m 4096M 表示最大使用 4GB 内存。同时，确保物理内存足够，并关闭其他占用内存的程序。

### 8.2 数据处理问题

问：导入数据时出现乱码怎么办？答：在导入设置页面，检查文件编码设置。对于中文数据，通常需要选择 UTF-8 或 GBK 编码。如果不确定文件的实际编码，可以使用文本编辑器的"另存为"功能将文件转换为 UTF-8 编码，然后再导入 OpenRefine。

问：如何删除重复行？答：使用"编辑行"菜单中的"移除重复行"功能。该功能会基于选定的列识别重复行，只保留第一次出现的行。建议在操作前先通过分面确认要保留的数据范围。也可以使用表达式自定义判断重复的逻辑。

问：如何批量修改特定模式的文本？答：使用"编辑"菜单中的"替换"功能。勾选"正则表达式"选项后，可以编写正则表达式来匹配特定模式的文本。例如，\s+ 可以匹配一个或多个空格，^ 和 $ 分别匹配开头和结尾。如果需要更复杂的替换逻辑，可以使用"基于表达式替换"功能，编写 GREL 表达式来生成替换结果。

### 8.3 扩展使用问题

问：如何启用扩展模块？答：扩展模块的启用方式取决于安装方式。对于预编译发行版，需要将扩展文件复制到 OpenRefine 安装目录的 webapp/extensions 文件夹中，并在启动配置中启用。对于从源码运行的开发者，扩展模块默认包含在构建中。具体的启用步骤请参考扩展的 README 文档。

问：数据库连接失败怎么办？答：首先确认数据库服务正在运行，网络连接正常。然后检查连接参数是否正确，包括主机地址、端口、数据库名、用户名和密码。对于某些数据库，还需要确认 JDBC 驱动是否正确安装。如果使用了特殊字符的密码，需要检查是否需要转义。如果问题仍然存在，查看 OpenRefine 的日志文件获取详细的错误信息。

问：Data-Quality 扩展的 OCR 服务无法连接怎么办？答：首先确认 Jinshu-aimp 服务已经启动，并且网络可达。然后检查 Data-Quality 扩展的配置中服务地址是否正确。默认配置通常是 http://127.0.0.1:7998，如果服务在其他地址运行，需要修改配置。如果服务在同一台机器上但端口不同，检查防火墙是否允许该端口的访问。

## 九、技术支持

### 9.1 官方资源

OpenRefine 官方网站 https://openrefine.org/ 提供了软件的下载链接、文档和使用指南。官方文档位于 https://openrefine.org/docs/，包含了详细的功能说明和操作指南。对于常见问题，官方 FAQ 页面 https://github.com/OpenRefine/OpenRefine/wiki/FAQ 提供了大量有用的信息。

GitHub 仓库 https://github.com/OpenRefine/OpenRefine/ 是软件开发的主阵地。用户可以在这里报告 Bug、提出功能建议、浏览源代码、参与讨论。提交问题前建议先搜索是否已有类似的问题，避免重复提交。参与社区讨论的渠道包括 Gitter 聊天室和 Matrix 频道，详细信息见 GitHub 仓库的联系方式部分。

### 9.2 社区支持

OpenRefine 拥有活跃的用户社区。社区论坛 https://forum.openrefine.org/ 是提问和交流的主要平台。发帖时提供详细的问题描述、使用的 OpenRefine 版本、操作系统信息，以及问题发生前后的操作步骤，有助于他人理解问题并提供帮助。论坛支持英文发帖，也欢迎中文用户交流。

Stack Overflow 是一个问答网站，许多技术问题在那里已经有了解答。搜索 "OpenRefine" 标签可以找到相关的问题和答案。如果遇到新问题，也可以发帖提问。遵循 Stack Overflow 的提问规范，清晰地描述问题和期望的结果，有助于获得有用的回答。

*文档版本：1.0*
*最后更新：2025年12月*
